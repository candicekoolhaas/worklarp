<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>work LARP</title>
  <style>
    body {
      background-image: url("background.jpeg");
      background-size: cover;       /* makes it fill the screen */
      background-repeat: no-repeat; /* don’t tile it */
      background-position: center;  /* center the image */
      font-family: "Times New Roman", Times, serif;
      text-align: center;
      margin-top: 50px;
    }

    .button-row {
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin: 10px 0;
    }

    .btn {
      border: none;
      background: none;
      cursor: pointer;
      margin: 0;
    }

    .btn img {
      width: 100px;
    }

    .label {
      margin: 0;
      font-size: 1.1em;
      color: #333;
    }

    .label-container {
      display: flex;          /* lay label and score in a row */
      align-items: center;    /* vertically align them */
      margin-left: 4px;      /* space from the button */
      gap: 10px;	 /* space between label and score */
      margin-top: 10px;              
    }

    .score {
      font-size: 1.1em;
      color: #555;
      margin: 0;            /* remove any margin */
      line-height: 1;       /* force it to align with label text */
    }
  </style>
</head>
<body>
  <h1>work LARP</h1>

  <!-- Avatar -->
  <img src="avatar.jpg" alt="Avatar" width="50"><br><br>

<!-- Login -->
<div id="loginDiv">
  <input type="text" id="passcodeInput" placeholder="Enter username">
  <button id="loginBtn">Login</button>
</div>

<!-- Display username -->
<div id="usernameDisplay" style="margin:10px; font-weight:bold;"></div>

  <!-- Restoration -->
<div class="button-row">
  <button class="btn" onclick="addPoints('Restoration', 1)">
    <img src="button1.jpg" alt="Button 1">
  </button>
  <div class="label-container">
    <div class="label">Restoration</div>
    <div id="Restorationscore">0</div>
 </div>
</div>

  <!-- Alchemy -->
<div class="button-row">
  <button class="btn" onclick="addPoints('Alchemy', 1)">
    <img src="button2.jpg" alt="Button 2">
  </button>
  <div class="label-container">
    <div class="label">Alchemy</div>
    <div id="AlchemyScore">0</div>
 </div>
</div>

<!-- Conjuration -->
<div class="button-row">
  <button class="btn" onclick="addPoints('Conjuration', 1)">
    <img src="button3.jpg" alt="Button 3">
  </button>
  <div class="label-container">
    <div class="label">Conjuration</div>
    <div id="ConjurationScore">0</div>
 </div>
</div>

<button onclick="resetScores()">Reset</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // ✅ Firebase config (fixed storageBucket)
  const firebaseConfig = {
    apiKey: "AIzaSyBUGoQLFbEwsizDNbNrGF0YHyc1yw-SSuo",
    authDomain: "worklarp.firebaseapp.com",
    projectId: "worklarp",
    storageBucket: "worklarp.appspot.com",
    messagingSenderId: "909526822561",
    appId: "1:909526822561:web:66b48f5dce174d1fca8ae0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let scores = {
    Restoration: 0,
    Alchemy: 0,
    Conjuration: 0
  };

  let currentPasscode = "";

  const buttons = document.querySelectorAll(".btn");
  const resetBtn = document.getElementById("resetBtn");

  // Enable buttons after login
  function enableButtons() {
    buttons.forEach(b => b.disabled = false);
    resetBtn.disabled = false;
  }

  document.getElementById("loginBtn").onclick = async () => {
    const passcode = document.getElementById("passcodeInput").value.trim();
    if (!passcode) return alert("Please enter a username!");
    currentPasscode = passcode;
    document.getElementById("usernameDisplay").innerText = "Logged in as: " + currentPasscode;
    await loadScores(passcode);
    enableButtons();
    document.getElementById("loginDiv").style.display = "none"; // hide login
  };

  async function loadScores(passcode) {
    const ref = doc(db, "players", passcode);
    const snapshot = await getDoc(ref);
    if (snapshot.exists()) {
      scores = snapshot.data();
      updateDisplay();
      console.log("Loaded existing player", passcode, scores);
    } else {
      await setDoc(ref, scores);
      console.log("New player created:", passcode);
    }
  }

  async function saveScores() {
    if (!currentPasscode) return;
    try {
      const ref = doc(db, "players", currentPasscode);
      await setDoc(ref, scores);
    } catch (e) {
      console.error("Save failed:", e);
    }
  }

  window.addPoints = (skill, points) => {
    scores[skill] += points;
    updateDisplay();
    saveScores();
  };

  window.resetScores = () => {
    for (const skill in scores) scores[skill] = 0;
    updateDisplay();
    saveScores();
  };

  function updateDisplay() {
    document.getElementById("Restorationscore").innerText = scores.Restoration;
    document.getElementById("AlchemyScore").innerText = scores.Alchemy;
    document.getElementById("ConjurationScore").innerText = scores.Conjuration;
  }
</script>

</body>
</html>
